"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"MPMFEMRGBALIGN-000","P0","1","both","固化基线运行与输出清单","固化 mpm_fem_rgb_compare 的可复现运行参数与输出结构，避免对比漂移。","在可运行环境执行基线命令产出 fem_XXXX.png/mpm_XXXX.png；生成 run_manifest.json（含 indenter/摩擦/marker/tint/record_interval 等生效值 + frame→phase 映射）；生成 metrics.csv/metrics.json 且可被 Import-Csv 解析；同机连续运行 2 次 total_frames 与映射一致。","AUTOE2E","默认不改 demo 行为，仅通过 CLI/manifest 固化；输出路径只写入 --save-dir；关键参数必须在启动日志/manifest 回显。","用推荐基线命令跑一次并核对输出结构、帧数与映射；抽查 3 帧（press/slide/hold）能在 manifest 中定位 phase。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:22;example/mpm_fem_rgb_compare.py:494;example/mpm_fem_rgb_compare.py:1808;example/mpm_fem_rgb_compare.py:2507;quick_test.py:111","picked_reason:P0 先固化可复现输出/manifest，便于后续对齐项回归;started_at:2025-12-27T21:06:30+08:00;done_at:2025-12-27T21:17:07+08:00;validation_limited:当前环境 Python3.13 缺少 xensesdk.ezgl/taichi，无法运行真实渲染/MPM 链路;manual_test:conda(env:xengym py3.9) 运行 python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --mpm-marker warp --mpm-depth-tint off --export-intermediate --save-dir output/rgb_compare/baseline;evidence:python quick_test.py (OK)；新增 preflight run_manifest 写入（无 ezgl 时也会写）;risk:low 仅在 --save-dir 时额外写 run_manifest.json；有依赖环境下主流程不变"
"MPMFEMRGBALIGN-010","P0","2","both","统一压头几何与接触面（tip/base）","统一 MPM/FEM 压头几何与尺寸来源，并确保 FEM 深度渲染接触面选对（tip 而非 15mm 方形底座）。","启动日志/manifest 明确打印两侧 indenter_type 与尺寸（mm）且一致；FEM 侧在 --fem-indenter-face tip 时接触轮廓外接尺度约 8mm（±1mm），不出现 15mm 方形底座尺度；base/tip 切换可稳定复现/消除“方框轮廓”用于验证。","AUTOE2E","避免引入新大体积资产；若调整朝向/姿态必须提供开关与回滚路径；记录 STL 端面统计/最终变换链路日志便于审计。","跑基线对比并抽查固定 frame_id：FEM/MPM 接触轮廓形状一致（或差异可解释）；保存至少 1 帧作为验证证据。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:27;example/mpm_fem_rgb_compare.py:767;example/mpm_fem_rgb_compare.py:2232;example/mpm_fem_rgb_compare.py:2443;example/mpm_fem_rgb_compare.py:2461;quick_test.py:172","picked_reason:P0 先收敛 STL tip/base 的可审计证据（无需依赖渲染环境）;started_at:2025-12-27T21:20:37+08:00;done_at:2025-12-27T21:26:53+08:00;validation_limited:当前环境缺少 xensesdk.ezgl/taichi，无法目视验证接触轮廓；仅用 STL 端面统计与 manifest 预期值做替代验收;manual_test:conda(env:xengym py3.9) 运行 python example/mpm_fem_rgb_compare.py --mode raw --fem-indenter-geom stl --fem-indenter-face tip --save-dir output/rgb_compare/fem_tip （确认 contact face≈8mm 且方框轮廓可控）;evidence:python quick_test.py (OK)；run_manifest.json resolved.indenter.fem.contact_face_size_mm≈8mm（tip）;risk:low 新增 resolved 字段/日志，不改变仿真与渲染默认行为"
"MPMFEMRGBALIGN-020","P0","3","both","统一坐标翻转与滑移方向（单一入口）","收敛 dx_slide 符号与 x 轴翻转逻辑到单一入口，并补齐同帧 pose 对照，消除“强边缘在相反侧”。","同一阶段内（press/slide）MPM obstacle_center.x 与 FEM object_pose.x 单调方向一致；翻转逻辑集中在一个明确函数/层，manifest/log 可解释最终坐标约定；开启 overlay/日志后能闭环验证左右一致。","AUTOE2E","翻转逻辑不得分散在物理/渲染/overlay 多处取反；新增调试日志/overlay 必须可开关且不污染默认输出。","用带 overlay 的保存帧核对左右一致；回归运行确保不再出现“强边缘在相反侧”的系统性现象。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:34;example/mpm_fem_rgb_compare.py:454;example/mpm_fem_rgb_compare.py:1844;example/mpm_fem_rgb_compare.py:2099;example/mpm_fem_rgb_compare.py:2527;quick_test.py:146","picked_reason:P0 先固化坐标/翻转约定到 manifest，降低后续排查成本;started_at:2025-12-27T21:31:37+08:00;done_at:2025-12-27T21:54:24+08:00;validation_limited:当前环境 Python3.13 缺少 xensesdk.ezgl/taichi，无法运行真实渲染/MPM 链路;manual_test:conda(env:xengym py3.9) 运行 python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --mpm-marker off --mpm-depth-tint off --mpm-show-indenter --debug --save-dir output/rgb_compare/pose_overlay 并检查 run_manifest.trajectory.frame_indenter_centers_m 与 [POSE] 日志左右一致;evidence:python quick_test.py (OK)；manifest 记录 conventions + frame_indenter_centers_m(依赖环境);risk:low 仅增加 manifest/trajectory 字段与 debug 输出对照点"
"MPMFEMRGBALIGN-030","P1","4","both","对齐摩擦参数（FEM fric_coef vs MPM mu_s/mu_k）","提供一键对齐入口并固化生效值，避免摩擦数量级差异主导剪切带观感。","CLI 支持 --fric（或等价）同时设置 FEM fric_coef 与 MPM mu_s/mu_k，且启动日志/manifest 回显对齐结果 aligned=true；在同一基线下，滑移阶段的观感差异不再主要由摩擦数量级差异导致（至少指标/中间量可解释）。","AUTOE2E","参数校验：摩擦必须 >=0；默认值不静默改变；manifest 记录最终生效的 fem_fric_coef/mpm_mu_s/mpm_mu_k。","跑一次基线对比并核对日志中的 Friction 对齐回显；回归确认输出帧数/映射未漂移。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:41;example/mpm_fem_rgb_compare.py:2361;example/mpm_fem_rgb_compare.py:2400;example/mpm_fem_rgb_compare.py:2535;xengym/fem/simulation.py:232;xengym/render/sensorScene.py:242;quick_test.py:160","picked_reason:P1 先固化 --fric 对齐的可验证证据（manifest/quick_test），避免后续视觉归因被摩擦数值干扰;started_at:2025-12-27T22:04:24+08:00;done_at:2025-12-27T22:09:17+08:00;validation_limited:当前环境缺少 xensesdk.ezgl/taichi，无法对滑移阶段观感做真实回归；本次仅验证 CLI/manifest 对齐与参数校验;manual_test:conda(env:xengym py3.9) 运行 python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --mpm-marker off --mpm-depth-tint off --save-dir output/rgb_compare/fric_aligned 并核对日志 Friction aligned=true 与 run_manifest.run_context.resolved.friction;evidence:python quick_test.py (OK)；新增 --fric preflight manifest 校验 aligned=true;risk:low 仅补充 smoke 覆盖与 refs 固化"
"MPMFEMRGBALIGN-040","P1","5","both","对齐渲染策略（tint/marker 语义可控）","把非物理渲染差异收敛为可控变量：基线关闭 MPM depth tint；marker 语义在 FEM/MPM 两侧可对齐（白底/warp）。","脚本提供可复现的两组输出：marker=off（白底）与 marker=warp；MPM depth tint 可通过 --mpm-depth-tint off 完全关闭；关闭 tint 后 MPM 图不再出现系统性的“整块脏/暗”叠色污染，且 marker=warp 时接触区出现可观测的局部位移/剪切（方向与 FEM 一致）。","AUTOE2E","所有可视化增强必须可开关且默认不影响旧 demo；marker warp 的 uv_disp_mm 更新需与帧对齐，并在 manifest 记录模式。","跑两组基线（tint on/off、marker off/warp），用保存帧与 metrics 对比确认 tint/marker 对观感差异的贡献可被量化说明。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:46;example/mpm_fem_rgb_compare.py:1809;example/mpm_fem_rgb_compare.py:2307;example/mpm_fem_rgb_compare.py:2560;xengym/render/sensorScene.py:276;quick_test.py:107;quick_test.py:163","picked_reason:P1 先把 tint/marker 差异收敛为可控开关（含 FEM marker off），为后续 halo/指标归因打底;started_at:2025-12-27T22:13:34+08:00;done_at:2025-12-27T22:18:38+08:00;validation_limited:当前环境缺少 xensesdk.ezgl/taichi，无法产出真实渲染帧验证 tint/warp 的观感；本次仅验证 CLI/manifest 开关与 smoke 逻辑;manual_test:conda(env:xengym py3.9) 运行两组命令 (1) python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --fem-marker off --mpm-marker off --mpm-depth-tint off --save-dir output/rgb_compare/marker_off (2) python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --fem-marker on --mpm-marker warp --mpm-depth-tint off --save-dir output/rgb_compare/marker_warp 并对比接触区 marker 位移/剪切与 tint 叠色贡献;evidence:python quick_test.py (OK)；manifest 记录 resolved.render.fem_marker/mpm_marker/mpm_depth_tint;risk:medium 需在可运行环境确认 warp 位移方向与 FEM 一致"
"MPMFEMRGBALIGN-050","P2","6","both","彩虹 halo 归因与高度场平滑/插值迭代","在几何/坐标/渲染开关对齐后，若仍存在彩虹 halo，则迭代 height_field 重建/平滑以削弱台阶与尖锐法线。","在 tint=off 且 marker=off 的基线下，固定 frame_id 的 halo 范围/强度下降（可用 ROI 颜色方差或饱和度峰值下降作为量化指标），同时接触轮廓尺度与主要形变结构保持不变；变更提供开关可回退。","AUTOE2E","优先通过参数化平滑验证（避免一次性大改）；若引入 splat/拟合需评估性能与数值稳定性，并记录对比指标。","对比同一 frame_id 的前/后输出帧与导出的 height_field 中间量；确认 halo 收敛且未抹平接触主结构。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:53;example/mpm_fem_rgb_compare.py:369;example/mpm_fem_rgb_compare.py:1007;example/mpm_fem_rgb_compare.py:2397;example/mpm_fem_rgb_compare.py:2664;quick_test.py:256","picked_reason:P2 在对齐项完成后提供可回退的 height_field 后处理开关（fill-holes/smooth-iters），为 halo 收敛提供手段;started_at:2025-12-27T22:33:11+08:00;done_at:2025-12-27T22:44:04+08:00;validation_limited:当前环境缺少 xensesdk.ezgl/taichi，无法对固定 frame_id 的 halo 强度做真实前后对比；本次交付可回退的 height_field 后处理开关与 manifest 记录;manual_test:conda(env:xengym py3.9) 在 tint=off 且 marker=off 基线下对同一输出目录做两次运行：A) 默认参数；B) 增加 --mpm-height-fill-holes on --mpm-height-fill-holes-iters 10（必要时调大 --mpm-height-smooth-iters），对比同一 frame_id 的 mpm_*.png 与 intermediate/frame_*.npz 中 height_field_mm/contact_mask 的边界连续性，并用 ROI 饱和度峰值/颜色方差量化 halo 变化；若效果不佳可回退 --mpm-height-fill-holes off;evidence:python quick_test.py (OK) 覆盖新 CLI/manifest conventions 开关;risk:medium 需要在可运行环境确认 halo 实际收敛且未过度抹平接触主结构"
"MPMFEMRGBALIGN-060","P1","7","both","导出中间产物与差异指标（可审计归因）","在一次对比运行中导出可对齐的中间量与逐帧指标，形成可审计证据链用于归因与回归。","开启 --export-intermediate 后生成 intermediate/frame_XXXX.npz（包含 height_field_mm、uv_disp_mm、contact_mask 等，shape 对齐 (140,80)/(140,80,2)）；生成 metrics.csv/metrics.json 且 Import-Csv 可解析；所有产物与 frame_id 严格对齐并可重复生成。","AUTOE2E","输出必须受开关控制且默认关闭，避免生成大数据；命名与 keys 稳定；异常写文件需降级告警不影响主流程。","跑一次基线开启 export，核对产物数量、字段 keys 与帧对齐；抽查 3 帧复算 RGB diff metrics 与落盘一致。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:60;example/mpm_fem_rgb_compare.py:1918;example/mpm_fem_rgb_compare.py:1977;example/mpm_fem_rgb_compare.py:2012;example/mpm_fem_rgb_compare.py:2167;quick_test.py:90","picked_reason:P1 先补齐 intermediate/metrics 的稳定 keys 与可离线验证的 smoke，形成可审计证据链;started_at:2025-12-27T22:24:29+08:00;done_at:2025-12-27T22:29:03+08:00;validation_limited:当前环境缺少 xensesdk.ezgl/taichi，无法跑完整对比生成真实逐帧 intermediate/metrics；但已用依赖无关的导出函数离线验证 keys/shape/CSV 可解析;manual_test:conda(env:xengym py3.9) 运行 python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --mpm-marker warp --mpm-depth-tint off --export-intermediate --save-dir output/rgb_compare/export 并核对 intermediate/frame_*.npz keys(height_field_mm/uv_disp_mm/contact_mask) 与 metrics.csv/metrics.json 帧对齐;evidence:python quick_test.py (OK) 覆盖 intermediate npz keys+shape 与 metrics.csv 可解析;risk:low 导出默认关闭，写文件失败降级告警不影响主流程"
"MPMFEMRGBALIGN-070","P2","8","both","回归测试与文档沉淀（防回退）","补充 smoke/regression 与文档，固化几何/翻转/参数生效值/输出结构等关键不变量，防止未来回退。","新增或更新 quick_test.py 或 example/test_*.py 覆盖：CLI 参数解析、manifest/metrics/intermediate 结构校验、端面统计函数、翻转约定；本机 python quick_test.py 通过；文档包含推荐基线命令与排查 checklist。","AUTOSERVER","测试应为 smoke 级且失败信息清晰；避免引入新依赖；依赖缺失时需明确 skip 原因。","在完整依赖环境下跑一次基线命令并核对文档描述与实际一致；测试能快速发现关键不变量回退。","已完成","已完成","已完成","已提交","","plan/2025-12-27_20-41-17-mpm-fem-rgb-align.md:1;quick_test.py:1;Report.md:1;example/mpm_fem_rgb_compare.py:20","picked_reason:P2 收尾：把报告/计划/回归 smoke 一并入库，固化关键不变量，防后续回退;started_at:2025-12-27T22:49:06+08:00;done_at:2025-12-27T22:56:12+08:00;validation_limited:当前环境缺少 xensesdk.ezgl/taichi，无法跑端到端渲染回归；已用 dependency-light quick_test 覆盖 CLI/manifest/metrics/intermediate/约定等关键不变量;manual_test:conda(env:xengym py3.9) 按 Report.md 的基线命令跑一次并核对输出目录结构与 checklist;evidence:python quick_test.py (OK)；更新 Report.md（基线命令+checklist）并提交 plan 文件;risk:low 文档/测试为主，无主流程破坏性改动;reopen_at:2025-12-27T23:11:28+08:00;reopen_reason:xengym 环境 conda run -n xengym python quick_test.py 失败（dummy.npz 不存在，触发 FEM 加载）;retest_at:2025-12-27T23:26:22+08:00;validation:conda run -n xengym python quick_test.py (OK);fix:quick_test 不再通过 subprocess 跑 --save-dir（避免 ezgl 环境下阻塞 UI），改为直接调用 _write_preflight_run_manifest 验证 manifest 结构"
"MPMFEMRGBALIGN-080","P0","9","both","xengym 环境复测并收敛剩余深度/伪影","在 conda 环境 xengym 复测 quick_test 与 mpm_fem_rgb_compare，复核交付；收敛 MPM 过深/广域下陷导致的暗盘与 halo，并对齐 FEM 深度缩放语义。","xengym 环境：quick_test 通过；mpm_fem_rgb_compare 产出 run_manifest.json + metrics.* + intermediate/*.npz；Report.md 记录真实复测命令与证据目录，且不再包含无法运行相关描述。","AUTOE2E","对齐策略（深度缩放/基线/平滑）必须在 run_manifest.json 记录；默认参数保持兼容；不引入新依赖。","复跑基线命令并抽查关键帧；quick_test.py 通过；输出结构（文件名/帧数/manifest/metrics）不回退。","已完成","已完成","已完成","已提交","","example/mpm_fem_rgb_compare.py:138;example/mpm_fem_rgb_compare.py:986;xengym/fem/simulation.py:459;xengym/mpm/mpm_solver.py:226","picked_reason:用户要求在 conda xengym 环境复测并调试到可交付;started_at:2025-12-29T02:19:11.217154+08:00;done_at:2025-12-29T05:22:27.9325671+08:00;validation:quick_test+mpm_fem_rgb_compare;evidence:output/rgb_compare/issue080-final3-2025-12-29_04-47-14;repro:output/rgb_compare/issue080-repro-2025-12-29_01-55-01-k800;manual_test:conda run -n xengym python quick_test.py;conda run -n xengym python example/mpm_fem_rgb_compare.py --mode raw --record-interval 5 --fric 0.4 --mpm-marker warp --mpm-depth-tint off --export-intermediate --save-dir output/rgb_compare/baseline"
