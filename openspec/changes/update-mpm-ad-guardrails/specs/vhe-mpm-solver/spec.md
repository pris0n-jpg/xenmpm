## MODIFIED Requirements

### Requirement: 自动微分接口
系统必须（SHALL）在可微接口中对当前不可微的路径提供明确保护：当底层 Taichi 不支持 P2G/G2P 原子操作的反向传播时，梯度入口（API/CLI）必须拒绝执行并返回清晰错误/警告与可行替代方案；禁止 Tape 尝试运行导致崩溃。

#### Scenario: 梯度调用被安全阻断
- **WHEN** 用户调用梯度接口（API 或 CLI）时
- **THEN** 如果当前后端不支持 P2G/G2P 的自动微分，系统必须直接抛出可读错误/警告，指出限制和可能的解决方案（等待上游、手动伴随、外部 AD），且不得进入 Tape 执行。

### Requirement: 文档一致性
系统必须（SHALL）确保所有在代码/警告中引用的限制或实施状态文档实际存在并路径一致；文档缺失或路径错误时应阻断发布或提供显式提示。

#### Scenario: 引用文档可访问
- **WHEN** 代码或运行时警告引用限制文档
- **THEN** 文档应存在于仓库中且路径正确；若缺失，构建/发布或运行时应提示并拒绝继续。

### Requirement: Loss 语义定义
系统必须（SHALL）在接口与文档中明确能量类 loss 的语义（动能或总能量），并与实现保持一致；若用户期望总能量匹配，应提供或记录相应的 loss kernel。

#### Scenario: 能量 loss 对齐
- **WHEN** 用户选择能量类 loss
- **THEN** 实际计算的能量范围与文档/接口约定一致（例如总能量=动能+弹性+粘性+投影，或明确为动能），并在文档中说明。

#### Scenario: 总能量 loss 可用（可选）
- **WHEN** 用户需要总能量（动能+弹性+粘性+投影）匹配
- **THEN** 系统提供 `total_energy` loss 选项或文档指引如何自定义总能量 loss，确保行为可预期。

### Requirement: 本构更新路径一致性
系统必须（SHALL）避免未测试的双路径漂移：要么统一本构更新 kernel，要么对多路径保持同步测试和文档说明，确保行为一致且可维护。

#### Scenario: 单一或同步路径
- **WHEN** 代码包含 STE/非 STE 等分支
- **THEN** 应通过编译时开关共享同一实现或提供同步测试保证行为一致，并在文档中标注默认路径。
